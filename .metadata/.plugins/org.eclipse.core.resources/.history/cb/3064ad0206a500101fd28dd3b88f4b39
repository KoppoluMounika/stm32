#include "uart_driver.h"
void UART2_Init(void)
{
    RCC->AHB2ENR |= RCC_AHB2ENR_GPIOAEN;
    RCC->APB1ENR1 |= RCC_APB1ENR1_USART2EN;

    // PA2=TX, PA3=RX -> AF7
    GPIOA->MODER &= ~((3<<4)|(3<<6));
    GPIOA->MODER |= (2<<4)|(2<<6);
    GPIOA->AFR[0] |= (7<<8)|(7<<12); // AF7

    USART2->BRR = 0x1117; // 9600 baud @ 80 MHz
    USART2->CR1 |= USART_CR1_TE | USART_CR1_UE;
}

void UART2_WriteChar(char c)
{
    while(!(USART2->ISR & USART_ISR_TXE));
    USART2->TDR = c;
}

void UART2_WriteString(char *str)
{
    while(*str)
        UART2_WriteChar(*str++);
}
